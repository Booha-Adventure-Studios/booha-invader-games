<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Booha Invaders</title>
  <meta name="theme-color" content="#05060b" />

  <!-- Optional favicon (change if you want) -->
  <!-- <link rel="icon" type="image/png" href="dotty-logo.jpg"> -->

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800;900&family=Noto+Sans+JP:wght@600;800;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg0:#05060b;
      --bg1:#070a16;
      --ink:#eaf1ff;

      --panel:#0b1030;
      --rim: rgba(130,170,255,.18);

      --glow: rgba(120,210,255,.85);
      --glow2: rgba(255,110,210,.55);

      --tileBorder: rgba(255,255,255,.10);

      --pulseDur: 2.35s;
      --tapScale: 1.03;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }

    body{
      background: var(--bg0);
      color: var(--ink);
      font-family: "Orbitron", system-ui, -apple-system, "Noto Sans JP", sans-serif;

      /* ✅ normal scrolling on mobile */
      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      overscroll-behavior-y:contain; /* ✅ keep */

      /* Invaders-y nebula */
      background-image:
        radial-gradient(circle at 18% 22%, rgba(80,120,255,.16), transparent 60%),
        radial-gradient(circle at 82% 20%, rgba(255,90,210,.12), transparent 62%),
        radial-gradient(circle at 74% 84%, rgba(70,240,255,.10), transparent 68%),
        radial-gradient(circle at 22% 78%, rgba(130,90,255,.12), transparent 66%),
        radial-gradient(circle at 50% 50%, rgba(20,30,60,.16), transparent 72%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg0) 100%);
    }

    /* aurora */
    body::before{
      content:"";
      position:fixed;
      inset:-25%;
      pointer-events:none;
      z-index:-1;
      background:
        conic-gradient(from 210deg at 50% 50%,
          rgba(255,90,210,.14),
          rgba(90,240,255,.10),
          rgba(170,120,255,.10),
          rgba(80,120,255,.14),
          rgba(255,220,120,.06),
          rgba(255,90,210,.14)
        );
      filter: blur(48px) saturate(1.12);
      opacity:.26;
      animation: bgDrift 24s ease-in-out infinite;
      mix-blend-mode: plus-lighter;
    }

    /* stars */
    body::after{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:-1;
      background:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.14) 0 1px, transparent 2px),
        radial-gradient(circle at 32% 64%, rgba(255,255,255,.10) 0 1px, transparent 2px),
        radial-gradient(circle at 58% 36%, rgba(255,255,255,.08) 0 1px, transparent 2px),
        radial-gradient(circle at 78% 74%, rgba(255,255,255,.12) 0 1px, transparent 2px),
        radial-gradient(circle at 90% 28%, rgba(255,255,255,.08) 0 1px, transparent 2px),
        radial-gradient(circle at 44% 20%, rgba(255,255,255,.07) 0 1px, transparent 2px);
      opacity:.30;
      animation: bgTwinkle 8.5s ease-in-out infinite;
    }

    .wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 20px 16px 28px;
    }

    .panel{
      width:min(980px, 100%);
      border-radius: 26px;
      padding: 22px 18px 18px;
      background: linear-gradient(180deg, rgba(10,14,34,.72), rgba(6,8,18,.62));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow:
        0 0 0 1px rgba(255,255,255,.06) inset,
        0 16px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(8px);
    }

    header{
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      gap:10px;
      padding: 6px 8px 12px;
    }

    .title{
      font-weight:900;
      letter-spacing:.08em;
      font-size: clamp(30px, 4.4vw, 58px);
      text-transform: uppercase;
      text-shadow:
        0 0 16px rgba(120,210,255,.18),
        0 0 44px rgba(255,90,210,.12);
    }

    .subtitle{
      font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
      font-weight:900;
      font-size: clamp(14px, 2.1vw, 20px);
      opacity:.92;
      letter-spacing:.02em;
      color: rgba(234,241,255,.88);
    }

    .hint{
      font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
      font-weight:800;
      font-size: clamp(12px, 1.8vw, 16px);
      opacity:.78;
      margin-top: 2px;
    }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
    }

    /* ✅ game tile */
    a.game{
      --pulseDurLocal: var(--pulseDur);
      --pulseDelay: 0s;

      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;

      width:100%;
      aspect-ratio: 1 / 1;
      border-radius: 22px;
      text-decoration:none;
      color: var(--ink);
      overflow:hidden;
      cursor:pointer;

      border: 2px solid rgba(255,255,255,.12);
      background:
        radial-gradient(circle at 25% 20%, rgba(120,210,255,.18), transparent 55%),
        radial-gradient(circle at 75% 75%, rgba(255,90,210,.12), transparent 62%),
        linear-gradient(145deg, rgba(8,10,22,.92), rgba(6,8,18,.92));

      box-shadow:
        0 0 0 1px rgba(255,255,255,.06) inset,
        0 0 16px rgba(120,210,255,.14),
        0 0 42px rgba(120,210,255,.08);

      transition: transform .18s ease, filter .22s ease, box-shadow .22s ease;
      -webkit-tap-highlight-color: transparent;
      will-change: transform;

      animation: tilePulse var(--pulseDurLocal) ease-in-out infinite;
      animation-delay: var(--pulseDelay);
    }

    a.game:hover{
      transform: scale(var(--tapScale));
      filter: brightness(1.10) saturate(1.06);
    }

    a.game.active{
      box-shadow:
        0 0 0 1px rgba(255,255,255,.08) inset,
        0 0 26px rgba(120,210,255,.22),
        0 0 80px rgba(255,90,210,.14);
      filter: brightness(1.18) saturate(1.10);
    }

    a.game.is-hidden{ visibility:hidden; }

    .badge{
      position:relative;
      z-index:3;
      width:min(78%, 220px);
      max-width: 240px;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      overflow:hidden;

      border: 2px solid rgba(255,255,255,.12);
      box-shadow:
        0 0 0 1px rgba(0,0,0,.35) inset,
        0 0 18px rgba(120,210,255,.16);
      background: rgba(0,0,0,.20);
    }

    .badge img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: translateZ(0);
    }

    /* ✅ locked center label */
    .label{
      position:relative;
      z-index:3;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:6px;
      width:100%;
      padding: 0 12px;
      text-align:center;
      transform:none !important;
    }

    .label .en{
      font-weight:900;
      letter-spacing:.06em;
      font-size: clamp(16px, 2.1vw, 20px);
      text-transform: uppercase;
    }
    .label .jp{
      font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
      font-weight:900;
      font-size: clamp(12px, 1.8vw, 15px);
      opacity:.86;
    }

    /* glow aura */
    a.game::after{
      content:"";
      position:absolute;
      inset:-10%;
      background:
        radial-gradient(circle at 30% 25%, rgba(120,210,255,.20), transparent 58%),
        radial-gradient(circle at 70% 75%, rgba(255,90,210,.14), transparent 64%);
      opacity:.55;
      mix-blend-mode: screen;
      pointer-events:none;
      z-index:1;
      filter: blur(.2px);
      animation: auraPulse var(--pulseDurLocal) ease-in-out infinite;
      animation-delay: var(--pulseDelay);
    }

    /* neon rim */
    .rim{
      position:absolute;
      inset:-2px;
      border-radius: 24px;
      pointer-events:none;
      z-index:2;
      box-shadow:
        0 0 0 2px rgba(255,255,255,.08) inset,
        0 0 22px rgba(120,210,255,.22),
        0 0 44px rgba(255,90,210,.12);
      opacity:.90;
    }

    /* sparkles */
    .sparkle{
      position:fixed;
      width:9px; height:9px;
      border-radius:50%;
      pointer-events:none;
      opacity:0;
      animation:sparkleFly 1.7s ease-out forwards;
      z-index:10050;
      mix-blend-mode:screen;
    }

    #fadeScreen{
      position:fixed;
      inset:0;
      background:#000;
      transform:translateY(100%);
      pointer-events:none;
      transition:transform 0.10s ease-in-out;
      z-index:9000;
    }
    #fadeScreen.show{ transform:translateY(0%); }

    footer{
      margin-top: 14px;
      padding: 10px 6px 0;
      text-align:center;
      font-family: system-ui, -apple-system, "Noto Sans JP", sans-serif;
      font-weight:800;
      font-size: 13px;
      color: rgba(234,241,255,.65);
      letter-spacing:.03em;
      padding-bottom: max(10px, calc(env(safe-area-inset-bottom) + 8px));
      pointer-events:none;
    }

    @keyframes bgDrift{
      0%   { transform: translate3d(-2%, -1%, 0) rotate(0deg) scale(1.05); }
      50%  { transform: translate3d( 2%,  1%, 0) rotate(18deg) scale(1.12); }
      100% { transform: translate3d(-2%, -1%, 0) rotate(0deg) scale(1.05); }
    }
    @keyframes bgTwinkle{
      0%,100%{ opacity:.26; }
      50%{ opacity:.40; }
    }
    @keyframes tilePulse{
      0%,100%{
        box-shadow:
          0 0 0 1px rgba(255,255,255,.06) inset,
          0 0 16px rgba(120,210,255,.14),
          0 0 42px rgba(120,210,255,.08);
        filter: brightness(1.00) saturate(1.00);
      }
      50%{
        box-shadow:
          0 0 0 1px rgba(255,255,255,.08) inset,
          0 0 22px rgba(120,210,255,.20),
          0 0 64px rgba(255,90,210,.12);
        filter: brightness(1.08) saturate(1.05);
      }
    }
    @keyframes auraPulse{
      0%,100%{ opacity:.45; transform:scale(1.00); }
      50%{ opacity:.70; transform:scale(1.02); }
    }
    @keyframes sparkleFly{
      0%{ transform:translate(0,0) scale(1); opacity:1; }
      100%{ transform:translate(var(--dx),var(--dy)) scale(.35); opacity:0; }
    }

    @media (max-width: 820px){
      .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .badge{ width:min(84%, 240px); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <div class="title">Booha Invaders</div>
        <div class="subtitle">ブーハー・インベーダーズ</div>
        <div class="hint">Tap a game to start.</div>
      </header>

      <div class="grid" id="grid">
        <!-- Dotty -->
        <a class="game" href="dotty.html" data-glow="rgba(120,210,255,.85)">
          <div class="rim"></div>

          <div class="badge" aria-hidden="true">
            <img src="dotty-logo.jpg" alt="Dotty" />
          </div>

          <div class="label">
            <div class="en">Dotty</div>
            <div class="jp">ドッティ</div>
          </div>
        </a>
      </div>

      <footer>Bryan’s English School</footer>
    </div>
  </div>

  <div id="fadeScreen"></div>

  <audio id="menuSfx" src="invader-index.mp3" preload="auto" playsinline></audio>

  <script>
    const sfx = document.getElementById("menuSfx");
    const grid = document.getElementById("grid");
    const fade = document.getElementById("fadeScreen");
    let transitioning = false;
    let audioPrimed = false;

    function safePlay(aud, vol=1){
      if(!aud) return;
      try{
        aud.pause();
        aud.volume = vol;
        if(aud.readyState >= 1) aud.currentTime = 0;
        aud.play().catch(()=>{});
      }catch(_){}
    }

    function primeAudioOnce(){
      if(audioPrimed) return;
      audioPrimed = true;
      safePlay(sfx, 1);
    }

    function sparkleBurst(rect, count=46, glow="rgba(120,210,255,.85)"){
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;

      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const radius = Math.min(rect.width, rect.height) * (0.22 + Math.random()*0.26);
        const x = cx + Math.cos(a)*radius;
        const y = cy + Math.sin(a)*radius;

        const speed = 84 + Math.random()*78;
        const dx = (Math.cos(a)*speed).toFixed(2);
        const dy = (Math.sin(a)*speed).toFixed(2);

        const s = document.createElement("div");
        s.className = "sparkle";
        s.style.left = (x - 4.5) + "px";
        s.style.top  = (y - 4.5) + "px";
        s.style.setProperty("--dx", dx + "px");
        s.style.setProperty("--dy", dy + "px");

        s.style.background =
          `radial-gradient(circle at 35% 35%,
            #fff 0 35%,
            ${glow} 60%,
            rgba(0,0,0,0) 76%
          )`;
        s.style.boxShadow = `0 0 10px #fff, 0 0 26px ${glow}, 0 0 60px ${glow}`;

        document.body.appendChild(s);
        setTimeout(()=>s.remove(), 1800);
      }
    }

    if(grid){
      grid.addEventListener("click", (e)=>{
        const tile = e.target.closest(".game");
        if(!tile) return;

        e.preventDefault();
        e.stopPropagation();

        if(transitioning) return;
        transitioning = true;

        primeAudioOnce();

        const target = tile.getAttribute("href");

        tile.classList.add("active");

        const r = tile.getBoundingClientRect();
        const clone = tile.cloneNode(true);
        clone.classList.add("active");

        // ✅ lock computed background so clone never changes
        const bg = getComputedStyle(tile).background;
        if(bg) clone.style.background = bg;

        // optional: lock border & text color
        clone.style.borderColor = getComputedStyle(tile).borderColor;
        clone.style.color = getComputedStyle(tile).color;

        clone.style.position = "fixed";
        clone.style.left = r.left + "px";
        clone.style.top  = r.top  + "px";
        clone.style.width  = r.width  + "px";
        clone.style.height = r.height + "px";
        clone.style.margin = "0";
        clone.style.transform = "translate(0px,0px) scale(1)";
        clone.style.zIndex = "9999";
        clone.style.pointerEvents = "none";
        clone.style.willChange = "transform";

        document.body.appendChild(clone);
        tile.classList.add("is-hidden");

        const glow = tile.getAttribute("data-glow") || "rgba(120,210,255,.85)";
        sparkleBurst(r, 52, glow);

        const cx = window.innerWidth/2  - (r.left + r.width/2);
        const cy = window.innerHeight/2 - (r.top  + r.height/2);

        const maxW = (window.innerWidth  * 0.90) / r.width;
        const maxH = (window.innerHeight * 0.90) / r.height;
        const safeScale = Math.min(3, maxW, maxH);

        const MOVE_MS = 820;
        const OPEN_MS = 940;

        if(fade){
          setTimeout(()=>{
            fade.classList.remove("show");
            requestAnimationFrame(()=>fade.classList.add("show"));
          }, 580);
        }

        clone.animate(
          [
            { transform: "translate(0px,0px) scale(1)" },
            { transform: `translate(${cx}px,${cy}px) scale(${safeScale})` }
          ],
          { duration: MOVE_MS, easing: "ease-in-out", fill: "forwards" }
        );

        setTimeout(()=>{ window.location.href = target; }, OPEN_MS);
      });
    }
  </script>
</body>
</html>
